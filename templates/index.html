{{ define "content" }}
<section style="margin-top: 10px; scroll-behavior: smooth;"></section>
<a href="/" style="text-decoration: none; color: inherit;"></a>
<div id="myBtnContainer">
  <a class="medium">{{.Title}}</a><a class="small" id="name"> {{ .User }} </a><br><a class="small">Total users: {{ .Count }}</a> <a class="small"> Users online: {{ .Online }} </a>
</div>
<div class="container-lg d-flex flex-column justify-content-center" style="margin-left: 125px;">
  <p class="lead">
    <a href="/thread/new" style="text-decoration: underline;">Start a thread </a><a> | or join one below!</a>
  </p>
  <form method="post" action="/">
  <select name="selection1" id="selection1" title="Choose">
    <option value="">Category</option>
    {{ if .PreferedCategory1 }}
      <option value="{{ .PreferedCategory1 }}" selected>{{ .PreferedCategory1 }}</option>
    {{ end }}
    <option value="Sports">Sports</option>
    <option value="Movies">Movies</option>
    <option value="Games">Games</option>
    <option value="Other">Other</option>
  </select>
  <select name="selection2" id="selection2" title="Choose">
    <option value="">Category</option>
    {{ if .PreferedCategory2 }}
      <option value="{{ .PreferedCategory2 }}" selected>{{ .PreferedCategory2 }}</option>
    {{ end }}
    <option value="AI-theme">AI-theme</option>
    <option value="Tomorrow-school">Tomorrow-school</option>
    <option value="Creativity">Creativity</option>
    <option value="Miscellaneous">Miscellaneous</option>
  </select>
  <button type="submit" class="btn btn-primary">Filter</button>
  <a href="/?reset=true" class="btn btn-secondary">Show All</a>
  </form>
  {{ if ne .User "" }}
  <div class="mb-3 p-2">
    <a href="/?sort=latest" name="sort" class='btn btn-sm btn-outline-secondary {{ if eq .SortBy "latest" }}active{{ end }}'>Latest</a>
    <a href="/?sort=most_liked" name="sort" class='btn btn-sm btn-outline-secondary {{ if eq .SortBy "most_liked" }}active{{ end }}'>Most Liked</a>
  </div>
  {{ else }} 
  <div class="mb-3 p-2">
    <a href="/login" class='btn btn-sm btn-outline-secondary {{ if eq .SortBy "latest" }}active{{ end }}'>Latest</a>
    <a href="/login" class='btn btn-sm btn-outline-secondary {{ if eq .SortBy "most_liked" }}active{{ end }}'>Most Liked</a>
  </div>
  {{ end }}
</div>
<div class="container-fluid d-flex">
  {{ if .Threads }}
  <div class="row g-4">
    {{ range .Threads }}
    {{ if gt .Len 60 }}
      <div class="col-md-6">
    {{ else }}
      <div class="col-lg-4">
    {{ end }}
    <div class="card shadow-sm h-100" style="border-bottom: solid 2px black;" id="thread-{{ .Id }}">
        {{ .Category1 }}{{ if and .Category1 .Category2 }}, {{ end }}{{ .Category2 }}
        <div class="card-body bg-light text-break">
          <span class="lead"><i class="fa fa-comments-o"> {{ .Topic }}</i></span>
        </div>
        <div class="card-footer p-2">
          <div class="small mb-2">Started by <a class="medium" href="/account?user_id={{.UserId}}" style="text-decoration: underline;">{{ .User }}</a> - {{ .CreatedAtDate }} - {{ .NumReplies }} posts.</div>
          <div class="d-flex align-items-center">
            <div class="btn-group" role="group">
              {{ if ne .User "" }}
                <form method="post" action="/back/thread/{{.Id}}/vote" style="display: inline;">
                  <input type="hidden" name="vote_type" value="like">
                  <button type="submit" class="btn btn-sm {{ if .UserLiked }}btn-success active{{ else }}btn-outline-success{{ end }} like-btn">
                    <i class="fa fa-thumbs-up"></i> <span id="likes-{{ .Id }}">{{ .LikesCount }}</span>
                  </button>
                </form>
                <form method="post" action="/back/thread/{{.Id}}/vote" style="display: inline;">
                  <input type="hidden" name="vote_type" value="dislike">
                  <button type="submit" class="btn btn-sm {{ if .UserDisliked }}btn-success active{{ else }}btn-outline-danger{{ end }} dislike-btn">
                    <i class="fa fa-thumbs-down"></i> <span id="dislikes-{{ .Id }}">{{ .DislikesCount }}</span>
                  </button>
                </form>
              {{ else }}
                <a href="/login" class="btn btn-sm btn-outline-success">
                  <i class="fa fa-thumbs-up"></i> <span>{{ .LikesCount }}</span>
                </a>
                <a href="/login" class="btn btn-sm btn-outline-danger">
                  <i class="fa fa-thumbs-down"></i> <span>{{ .DislikesCount }}</span>
                </a>
              {{ end }}
            </div>
            <a href="/thread/read?id={{.Id }}" class="btn btn-sm btn-outline-primary" style="text-decoration: underline; background: #007bff; color: white;">Read more</a>
          </div>
        </div>
      </div>
    </div>
    {{ end }}
  </div>
  {{ end }}
</div>
</section>
  <script>
    document.querySelectorAll('.like-btn, .dislike-btn').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        const card = btn.closest('[id^="thread-"]');
        if (card) {
          localStorage.setItem('flashThreadId', card.id);
        }
      });
    });

    window.addEventListener('DOMContentLoaded', function() {
      const flashId = localStorage.getItem('flashThreadId');
      if (flashId) {
        const el = document.getElementById(flashId);
        if (el) {
          el.classList.add('flash-highlight');
          setTimeout(function() {
            el.classList.remove('flash-highlight');
          }, 2000);
        }
        localStorage.removeItem('flashThreadId');
      }
    });
  </script>
{{ end }}

